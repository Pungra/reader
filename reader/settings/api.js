!function(){function t(){return y("token.settings")}function e(){x.Authorization+=u("token")||t();var e=$.ajax({url:v,headers:x,cache:!1,type:"POST",contentType:"application/json",dataType:"json"}),n=$.ajax({url:w,headers:x,cache:!1,contentType:"application/json",dataType:"json"}),i=$.ajax({url:b,headers:x,cache:!1,contentType:"application/json",dataType:"json"});return $.when(i,e,n).done(function(t,e,n){T.manifest=o(t[0]),T.user=r(e[0]),T.settings=c(n[0]),T.isInited=!0})}function n(){if(!T.isInited)throw"Sorry, but you've tried to use api before it was initialized"}function i(){return n(),T.manifest}function s(){return n(),T.user}function a(){return n(),T.settings}function o(t){if(t&&t.languages&&t.languages.length>0)for(var e=0;e<t.languages.length;e++)t.languages[e].url=S+t.languages[e].url;return t}function r(t){t=t.data;var e={accessType:0},n=1;return t.subscription&&t.subscription.accessType&&t.subscription.accessType>=n&&new Date(t.subscription.expirationDate)>=new Date&&(e.accessType=t.subscription.accessType),e}function c(t){var e;return e=t.settings&&t.settings.length>0?JSON.parse(t.settings):{xApi:{enabled:!0,selectedLrs:"default",lrs:{credentials:{}}},masteryScore:{}}}function u(t){var e=RegExp(t+"=(.+?)(&|$)").exec(location.search)||null;return null===e?null:decodeURI(e[1])}function g(t,e,n,i){l();var s={settings:t,extraSettings:e},a={url:w,type:"POST",headers:x,cache:!1,dataType:"json",data:s};return $.ajax(a).done(function(){f(n,!0)}).fail(function(){f(i,!1)}).always(function(){p()})}function l(){h({type:"freeze-editor"})}function p(){h({type:"unfreeze-editor"})}function f(t,e){h({type:"notification",data:{success:e,message:t}})}function d(){h({type:"show-settings"})}function h(t){var e=window.parent;e.postMessage(t,"*")}function y(t){for(var e=t+"=",n=document.cookie.split(";"),i=0;i<n.length;i++){for(var s=n[i];" "==s.charAt(0);)s=s.substring(1);if(0==s.indexOf(e))return s.substring(e.length,s.length)}}var T={isInited:!1},j=location.protocol+"//"+location.host,v=j+"/auth/identity",w=j+"/api/course/"+u("courseId")+"/template/"+u("templateId"),S=location.toString().substring(0,location.toString().indexOf("/settings/"))+"/",b=S+"manifest.json",x={Authorization:"Bearer "};window.egApi={init:e,getManifest:i,getUser:s,getSettings:a,saveSettings:g,sendNotificationToEditor:f,showSettings:d,getSettingsToken:t}}();