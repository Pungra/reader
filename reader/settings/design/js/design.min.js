!function(e){e.localize=function(e){return o[e]};var o={"changes are saved":"All changes are saved","changes are not saved":"Changes have NOT been saved. Please reload the page and change the settings again. Contact support@easygenerator.com if problem persists.","settings are not initialize":"Template settings are not initialized. Please reload the page and change the settings again. Contact support@easygenerator.com if problem persists.","graphical customization":"Graphical customization","customize your course":"Customize your course","look and feel of the course":"Change the look and feel of the course","custom course logo":"Custom course logo:",or:"or","upload logo image":"Upload logo image","logo hint":"- recommended size 300x120 px, allowed formats: jpeg, jpg, png, bmp, gif","clear logo":"Clear logo","upgrade account hint":'You have to <a target="_blank" href="/account/upgrade">upgrade your account</a> in order to set custom course logo',"logo update":"Change","logo remove":"Clear","choose color scheme":"Choose color scheme:",scheme:"Scheme:",httpIsNotAllowed:"HTTP content is not allowed. Please use HTTPS.","background change":"Change background:","background update":"Change background","background remove":"Clear background","background original":"Original","background repeat":"Repeat","background fullscreen":"Fullscreen","background upgrade account hint":'You have to <a target="_blank" href="/account/upgrade">upgrade your account</a> in order to set custom course background',"no-settings-message":"There is no layout settings yet."}}(window.app=window.app||{}),function(e){function o(e){var o=e.name.split(".").pop().toLowerCase();return $.inArray(o,c.supportedExtensions)===-1?{title:"Unsupported image format",description:"(Allowed formats: "+c.supportedExtensions.join(", ")+")"}:!(e.size>1024*c.maxFileSize*1024)||{title:"File is too large",description:"(Max file size: "+c.maxFileSize+"MB)"}}function n(e){var o=RegExp(e+"=(.+?)(&|$)").exec(location.search)||null;return null===o?null:decodeURI(o[1])}function t(){return window.egApi.getSettingsToken()}function r(){var e=$.Deferred();if(s.Authorization)e.resolve();else{var o=t();s.Authorization+="Bearer "+(n("token")||o),e.resolve()}return e.promise()}function a(){var e=location.protocol+"//localhost:222/image/upload",o="https://images-staging.easygenerator.com/image/upload",n="https://images.easygenerator.com/image/upload";return location.host.indexOf("localhost")!==-1?e:location.host.indexOf("live.easygenerator.com")!==-1||location.host.indexOf("beta.easygenerator.com")!==-1?n:o}var i=a(),s={Authorization:""},l={title:"Something went wrong",description:"Please, try again"},c={maxFileSize:10,supportedExtensions:["jpeg","jpg","png","bmp","gif"]};e.upload=function(e){var n=$.Deferred(),t=$("<form>").hide().attr("method","post").attr("enctype","multipart/form-data").insertAfter("body"),a=$("<input>").attr("accept",c.supportedExtensions.map(function(e){return"."+e}).join(", ")).attr("type","file").attr("name","file").on("change",function(){e&&e();var t=this.files[0],a=o(t);if(a!==!0)return void n.reject(a);var c=new FormData;c.append("file",t),r().then(function(){$.ajax({url:i,type:"POST",headers:s,data:c,contentType:!1,processData:!1}).done(function(e){e?n.resolve(e.url):n.reject(l)}).fail(function(){n.reject(l)})})}).appendTo(t);return a.click(),n.promise()}}(window.app=window.app||{}),function(e){function o(e){return/^(?:https:\/\/)[\w.-]+(?:\.[\w\.-]+)+[\w\-\._~:\/?#[\]@!\$&\'\(\)\*\+,;=.%]+$/gm.test(e)}function n(e){return/^(?:http:\/\/)[\w.-]+(?:\.[\w\.-]+)+[\w\-\._~:\/?#[\]@!\$&\'\(\)\*\+,;=.%]+$/gm.test(e)}function t(e){return/^(?:http(s)?:\/\/)?[\w.-]+(?:\.[\w\.-]+)+[\w\-\._~:\/?#[\]@!\$&\'\(\)\*\+,;=.%]+$/gm.test(e)}function r(e){return/^https/gm.test(e)?e:"https://"+e}function a(e){var o=$.Deferred();return $.ajax({url:e,type:"HEAD"}).then(function(){o.resolve(!0)}).fail(function(){o.resolve(!1)}),o.promise()}e.validateUrl=function(e){var i=$.Deferred();if(n(e))i.resolve("");else if(o(e))i.resolve(e);else{if(t(e))return a(r(e)).then(function(o){return o?r(e):""});i.resolve("")}return i.promise()}}(window.app=window.app||{}),function(){ko.bindingHandlers.fadeVisible={init:function(e,o){var n=o();$(e).toggle(ko.unwrap(n))},update:function(e,o){var n=o();ko.unwrap(n)?$(e).fadeIn():$(e).fadeOut()}},ko.bindingHandlers.localize={init:function(e,o){var n=$(e),t=ko.unwrap(o());n.html(app.localize(t))}},ko.bindingHandlers.background={init:function(e){$(e).css("background-size","cover").css("background-position","center").css("background-repeat","no-repeat")},update:function(e,o){var n=ko.unwrap(o());if($(e).css("background-image","none"),n){var t=new Image;t.onload=function(){$(e).css("background-image","url("+n+")")},t.src=n}}}}(),function(e){function o(e){this.hasStarterPlan=e&&e.accessType>0}function n(o,n){function t(e){e&&(d.setUrl(e.url),d.setLogoUrl(e.url))}function r(){d.isLoading()||e.upload(function(){s()}).done(function(e){l(e),c(e),a(),n()}).fail(function(e){i(e.title,e.description),n()})}function a(){d.isLoading(!1),d.isError(!1)}function i(e,o){d.clear(),d.isLoading(!1),d.isError(!0),d.errorText(e),d.errorDescription(o)}function s(){d.clear(),d.isLoading(!0)}function l(e){d.url(e||"")}function c(e){d.logoUrl(e||"")}function u(){return{url:d.logoUrl()}}function g(){return url=d.url(),url?e.validateUrl(url).then(function(o){return o?(d.isValidUrl(!0),d.setLogoUrl(o),void n()):(d.isValidUrl(!1),void d.errorText(e.localize("httpIsNotAllowed")))}):(d.setLogoUrl(),void d.isValidUrl(!0))}var d=this;return d.url=ko.observable(""),d.logoUrl=ko.observable(""),d.clear=function(){d.url(""),d.logoUrl(""),n()},d.isError=ko.observable(!1),d.isValidUrl=ko.observable(!0),d.errorText=ko.observable(""),d.errorDescription=ko.observable(""),d.isLoading=ko.observable(!1),d.hasLogo=ko.computed(function(){return d.isError(!1),""!==d.logoUrl()}),d.setUrl=l,d.setLogoUrl=c,d.getData=u,d.upload=r,d.validateUrl=g,t(o),d}function t(e,o){function n(e){e&&e.key&&l.selectByName(e.key)}function t(e){ko.utils.arrayForEach(l.list,function(e){e.isSelected(!1)}),e.isSelected(!0),o()}function r(e){ko.utils.arrayForEach(l.list,function(o){o.isSelected(o.name===e)})}function a(){var e=location.toString().indexOf("/settings/"),o=location.toString().substring(0,e),n=["v="+(new Date).getTime(),"theme="+l.selectedThemeName()].join("&");window.open(o+"?"+n,"_blank")}function i(){return{key:l.selectedThemeName()}}function s(e,o){var n=this;return n.name=e,n.isSelected=ko.observable(o===!0),n}var l=this;return l.list=[new s("light",(!0)),new s("black")],l.selectedThemeName=ko.computed(function(){var e="";return ko.utils.arrayForEach(l.list,function(o){o.isSelected()&&(e=o.name)}),e},l),l.select=t,l.selectByName=r,l.openDemo=a,l.getData=i,n(e),l}function r(o,n){var t=$.extend(!0,{image:{src:null,type:"fullscreen"}},o),r=this;r.image=ko.observable(t.image.src),r.image.isUploading=ko.observable(!1),r.image.isEmpty=ko.computed(function(){return!(r.image()&&r.image().length>0)}),r.type=ko.observable(t.image.type),r.type.fullscreen=function(){r.type("fullscreen"),n()},r.type.repeat=function(){r.type("repeat"),n()},r.type.original=function(){r.type("original"),n()},r.errorTitle=ko.observable(),r.errorDescription=ko.observable(),r.hasError=ko.observable(!1),r.changeImage=function(){r.image.isUploading()||e.upload(function(){r.image.isUploading(!0),r.hasError(!1),r.errorTitle(void 0),r.errorDescription(void 0)}).done(function(e){r.image(e)}).fail(function(e){r.image(void 0),r.hasError(!0),r.errorTitle(e.title),r.errorDescription(e.description)}).always(function(){n(),r.image.isUploading(!1)})},r.clearImage=function(){r.image(null),n()},r.getData=function(){return{image:{src:r.image(),type:r.type()}}}}e.UserAccessModel=o,e.LogoModel=n,e.ThemesModel=t,e.BackgroundModel=r}(window.app=window.app||{}),function(e){var o=null,n=null,t={isError:ko.observable(!1),userAccess:null,logo:null,background:null};t.getCurrentSettingsData=function(e){return $.extend({},e||o,{logo:t.logo.getData(),theme:t.themes.getData(),background:t.background.getData()})},t.getCurrentExtraData=function(){return{}},t.saveChanges=function(){var r=t.getCurrentSettingsData(),a=t.getCurrentExtraData(),i=JSON.stringify(r),s=JSON.stringify(a);JSON.stringify(o)===i&&JSON.stringify(n)===s||window.egApi.saveSettings(i,s,e.localize("changes are saved"),e.localize("changes are not saved")).done(function(){o=r,n=a})},t.init=function(){var r=window.egApi;return r.init().then(function(){var a=r.getUser(),i=r.getSettings();t.userAccess=new e.UserAccessModel(a),t.logo=new e.LogoModel(i.logo,t.saveChanges),t.themes=new e.ThemesModel(i.theme,t.saveChanges),t.background=new e.BackgroundModel(i.background,t.saveChanges),o=t.getCurrentSettingsData(i),n=t.getCurrentExtraData()}).fail(function(){t.isError(!0)})},t.init().always(function(){$(document).ready(function(){ko.applyBindings(t,$(".settings-container")[0]),$(window).on("blur",t.saveChanges)})})}(window.app=window.app||{});